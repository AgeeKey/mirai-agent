# Mirai Agent Alert Rules
groups:
  - name: trading_alerts
    rules:
      # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
      - alert: CriticalDrawdown
        expr: mirai_drawdown_current_percent > 10
        for: 1m
        labels:
          severity: critical
          component: trading
        annotations:
          summary: "üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–°–ê–î–ö–ê: {{ $value }}%"
          description: "–¢–µ–∫—É—â–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }}%, —á—Ç–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥ –≤ 10%"
          
      # –ë–æ–ª—å—à–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
      - alert: HighDrawdown
        expr: mirai_drawdown_current_percent > 5
        for: 2m
        labels:
          severity: warning
          component: trading
        annotations:
          summary: "‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞: {{ $value }}%"
          description: "–¢–µ–∫—É—â–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }}%, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
          
      # –ù–∏–∑–∫–∏–π –≤–∏–Ω—Ä–µ–π—Ç
      - alert: LowWinRate
        expr: mirai_win_rate_percent < 45
        for: 5m
        labels:
          severity: warning
          component: trading
        annotations:
          summary: "üìâ –ù–∏–∑–∫–∏–π –≤–∏–Ω—Ä–µ–π—Ç: {{ $value }}%"
          description: "–í–∏–Ω—Ä–µ–π—Ç —É–ø–∞–ª –¥–æ {{ $value }}%, –≤–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π"
          
      # –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
      - alert: NoTradingActivity
        expr: increase(mirai_trades_total[1h]) == 0
        for: 2h
        labels:
          severity: warning
          component: trading
        annotations:
          summary: "üîá –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ—Ä–≥–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
          description: "–ù–µ –±—ã–ª–æ —Å–¥–µ–ª–æ–∫ –±–æ–ª–µ–µ 2 —á–∞—Å–æ–≤"
          
      # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
      - alert: TooManyPositions
        expr: mirai_positions_active > 10
        for: 1m
        labels:
          severity: warning
          component: risk
        annotations:
          summary: "üìä –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–π: {{ $value }}"
          description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π ({{ $value }}) –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ª–∏–º–∏—Ç"

  - name: ai_alerts
    rules:
      # AI –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
      - alert: AINotResponding
        expr: up{job="mirai-ai-orchestrator"} == 0
        for: 1m
        labels:
          severity: critical
          component: ai
        annotations:
          summary: "ü§ñ AI Orchestrator –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          description: "AI Orchestrator –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã"
          
      # –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI
      - alert: LowAIConfidence
        expr: mirai_ai_confidence_score < 30
        for: 5m
        labels:
          severity: warning
          component: ai
        annotations:
          summary: "üß† –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI: {{ $value }}%"
          description: "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å AI —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ {{ $value }}%"
          
      # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã AI
      - alert: SlowAIResponse
        expr: histogram_quantile(0.95, mirai_ai_response_time_seconds) > 10
        for: 2m
        labels:
          severity: warning
          component: ai
        annotations:
          summary: "üêå –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã AI"
          description: "95% –æ—Ç–≤–µ—Ç–æ–≤ AI –∑–∞–Ω–∏–º–∞—é—Ç –±–æ–ª–µ–µ 10 —Å–µ–∫—É–Ω–¥"

  - name: system_alerts
    rules:
      # –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
      - alert: HighCPUUsage
        expr: mirai_system_cpu_percent > 80
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "üíª –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU: {{ $value }}%"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }}%"
          
      # –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
      - alert: HighMemoryUsage
        expr: mirai_system_memory_percent > 85
        for: 3m
        labels:
          severity: critical
          component: system
        annotations:
          summary: "üß† –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: {{ $value }}%"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }}%"
          
      # –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
      - alert: LowDiskSpace
        expr: mirai_system_disk_percent > 90
        for: 1m
        labels:
          severity: critical
          component: system
        annotations:
          summary: "üíæ –ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ: {{ $value }}%"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }}%"
          
      # API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      - alert: APIDown
        expr: up{job="mirai-trading-api"} == 0 or up{job="mirai-web-api"} == 0
        for: 1m
        labels:
          severity: critical
          component: api
        annotations:
          summary: "üåê API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          description: "–û–¥–∏–Ω –∏–∑ API —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          
      # –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
      - alert: HighAPIResponseTime
        expr: histogram_quantile(0.95, mirai_api_response_time_seconds) > 5
        for: 2m
        labels:
          severity: warning
          component: api
        annotations:
          summary: "üêå –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã API"
          description: "95% –æ—Ç–≤–µ—Ç–æ–≤ API –∑–∞–Ω–∏–º–∞—é—Ç –±–æ–ª–µ–µ 5 —Å–µ–∫—É–Ω–¥"

  - name: emergency_alerts
    rules:
      # –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
      - alert: EmergencyStopActivated
        expr: increase(mirai_emergency_stops_total[5m]) > 0
        for: 0s
        labels:
          severity: critical
          component: emergency
        annotations:
          summary: "üö® –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –û–°–¢–ê–ù–û–í–ö–ê –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê"
          description: "–ë—ã–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏"
          
      # –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
      - alert: LongUptime
        expr: mirai_system_uptime_seconds > 604800  # 7 –¥–Ω–µ–π
        for: 1h
        labels:
          severity: info
          component: system
        annotations:
          summary: "‚è∞ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ–ª–µ–µ 7 –¥–Ω–µ–π"
          description: "–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç {{ $value | humanizeDuration }}, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞"

  - name: market_alerts
    rules:
      # –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
      - alert: HighMarketVolatility
        expr: mirai_market_volatility > 0.1
        for: 10m
        labels:
          severity: warning
          component: market
        annotations:
          summary: "üìà –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞"
          description: "–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }}, –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã"